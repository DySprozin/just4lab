<?phpdefined ('ROOT') or exit();$user = 'rrr';class Cls_Kvak { public $ingroup = array(); //Массив группа => пользователи public $chmod = array(); //Массив группа => доступ  protected $chmods; //Доступ по всем группам, в которых есть пользователь protected $user; //текущий пользователь protected $groups = array(); //группы, к которым принадлежит текущий юзер public function __construct() {  if (empty($GLOBALS['user'])) $this->user = 'guest';  else {   $this->user = $GLOBALS['user'];   $this->groups[] = 'Student'; //По умолчанию залогиненные пользователи - студенты  }  $this->chmods = '';  $ingroup_path = ROOT . 'conf/kvak/groups/';  $ingroup_array = scandir($ingroup_path);    //Получаем массив группа => пользователи  foreach ($ingroup_array as $group) {   if ($group == '.' || $group == '..') continue;   $this->ingroup[$group] = file($ingroup_path . $group);  }  //Получаем список групп, к которым принадлежит текущий юзер  foreach ($this->ingroup as $group => $users) {   if (in_array($this->user, $users)) {    $this->groups[] = $group;   }  } } }class Cls_Kvak_Items extends Cls_Kvak { ## #Структура создания пункта квака, которую запоняем вручную public $img_src = ''; public $a_title = ''; public $img_alt = ''; public $img_class = 'img_right_menu'; public $div_class = 'border_right_menu'; // | border_right_menu2line public $f = 'n/a'; public $title = ''; public $title2 = ''; public $active = 'off'; # ## /** Конструктор с указанием доступа* @param string - (r, w, x, e, E, d, D), x - создавать темы, e/E - править свои/чужие топики, d/D - удалять -||-*/ public function __construct() {  parent::__construct();  $this->chmod['Guest'] = 'r';  $this->chmod['Admin'] = 'rwxED';  $this->chmod['Assistent'] = 'e';  $this->chmod['Prepod'] = 'e';  $this->chmod['Student'] = 'rwx'; }  public function str_unique($str) {  return join(array_unique(str_split($str))); }  public function get_chmods() {  $chmods = '';  foreach ($this->groups as $group) {   $chmods .= isset($this->chmod[$group]) ? $this->chmod[$group] : '';  }  $chmods = $this->str_unique($chmods);  $this->chmods = $chmods; }  public function kvak() {  //get chmods  $this->get_chmods();  if (!strpbrk($this->chmods, 'rED')) return '';  if ($this->active == 'off') {   $link = <<< LINK   $this->chmods <a class="right_link_kva" href="/kvak/$this->f/" title='$this->a_title'>$this->title</a> $this->title2LINK;  }  else {   $link = <<< LINK    <a href="#main_top" class="visited" onclick="blink('actual_title')">$this->title</a> $this->title2</a>LINK;  }  $new_kvak = <<<KVAK     <img src="$this->img_src" alt="$this->img_alt" class="$this->img_class">   <div class="$this->div_class">    $link   </div>   <br class="break">KVAK;  return $new_kvak; }}